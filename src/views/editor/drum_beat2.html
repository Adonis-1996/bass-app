<div
  ng-if="slide.initialized"
  sly-show="slide.visible"
  class="drums-beat"
  ng-init="beat = workspace.trackSection.beat(slide.beat.bar, slide.beat.beat)"
  ng-click="editor.click($event, beat)"
  msd-wheel="editor.volumeScroll($event, beat, $delta/10)"
  style="height: {{ :: 48 * workspace.trackSection.instrument.length }}px;"
  drop-channel="drum"
  ui-on-drag-over="editor.onDragOver($event, beat)"
  xxui-on-drag-enter="editor.onDragEnter($event, beat)"
  xxui-on-drag-leave="editor.onDragLeave($event, beat)"
  ui-on-drop="editor.onDrop($event, beat, $data)">
<!--   <div
    ng-repeat="subbeat in [1,2,3,4] | limitTo: beat.subdivision track by subbeat"
    class="drumset-grid">
    <div
      ng-repeat="drum in ::workspace.track.instrument track by drum.name"
      class="grid-cell">
    </div>
  </div> -->

<!--   <svg width="100%" height="384">
    <defs>
      <pattern id="grid-3" x="16.67%" y="0" width="33.33%" height="48" patternUnits="userSpaceOnUse">
        <circle cx="17" cy="24" r="16" fill="none" stroke="#ccc"/>
      </pattern>
      <pattern id="grid-4" x="12.5%" y="0" width="25%" height="48" patternUnits="userSpaceOnUse">
        <circle cx="17" cy="24" r="16" fill="none" stroke="#ccc"/>
      </pattern>
    </defs>
    <rect
      class="grid-4"
      transform="translate(-17, 0)"
      fill="url(#grid-4)"
      width="110%"
      height="100%"
    />
    <rect
      class="grid-3"
      transform="translate(-17, 0)"
      fill="url(#grid-3)"
      width="110%"
      height="100%"
    />
  </svg> -->

  <div
    class="drum-grid"
    ng-switch="beat.subdivision">
    <svg width="100%" height="100%" ng-switch-when="4">
      <defs>
        <pattern id="grid-4" x="12.5%" y="0" width="25%" height="48" patternUnits="userSpaceOnUse">
          <circle cx="17" cy="24" r="16" fill="none" stroke="#ccc"/>
        </pattern>
      </defs>
      <rect
        class="grid-4"
        transform="translate(-17, 0)"
        fill="url(#grid-4)"
        width="110%"
        height="100%"
      />
    </svg>
    <svg width="100%" height="100%" ng-switch-when="3">
      <defs>
        <pattern id="grid-3" x="16.67%" y="0" width="33.33%" height="48" patternUnits="userSpaceOnUse">
          <circle cx="17" cy="24" r="16" fill="none" stroke="#ccc"/>
        </pattern>
      </defs>
      <rect
        class="grid-3"
        transform="translate(-17, 0)"
        fill="url(#grid-3)"
        width="110%"
        height="100%"
      />
    </svg>
  </div>

<!--   <svg width="100%" height="384" ng-if="slide.beat.subdivision === 4">
    <defs>
      <pattern id="grid-4" x="12.5%" y="0" width="25%" height="48" patternUnits="userSpaceOnUse">
        <circle cx="17" cy="24" r="16" fill="none" stroke="#ccc"/>
      </pattern>
    </defs>
    <rect
      class="grid-4"
      transform="translate(-17, 0)"
      fill="url(#grid-4)"
      width="110%"
      height="100%"
    />
  </svg>

  <svg width="100%" height="384" ng-if="slide.beat.subdivision === 3">
    <defs>
      <pattern id="grid-3" x="16.67%" y="0" width="33.33%" height="48" patternUnits="userSpaceOnUse">
        <circle cx="17" cy="24" r="16" fill="none" stroke="#ccc"/>
      </pattern>
    </defs>
    <rect
      class="grid-3"
      transform="translate(-17, 0)"
      fill="url(#grid-3)"
      width="110%"
      height="100%"
    />
  </svg> -->

  <div
    ng-repeat="sound in beat.data track by (sound.drum + sound.subbeat)"
    class="drum-sound2"
    ng-style="{
      left: (100*(sound.subbeat-1)/beat.subdivision)+'%',
      width: (100/beat.subdivision)+'%'
    }"
    style="top: {{ ::workspace.trackSection.instrument.index[sound.drum] * 48 }}px;"
    ui-draggable="true"
    drag-channel="drum"
    drag="sound">
    <div
      class="volume-meter"
      ng-style="{
        transform: 'scale('+sound.volume+','+sound.volume+')'
      }">
    </div>
  </div>
</div>
