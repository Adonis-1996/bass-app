<div class="bass-board">
  <div class="string-container">
    <div
      ng-repeat="string in ::bass.strings track by string.index"
      class="bass-string">
    </div>
  </div>

  <div
    class="subbeats-container"
    layout="column"
    ng-repeat="bassSubbeats in beat.subbeats track by $index"
    xng-init="renderingBar(beat.bar+':'+beat.beat+':'+$index+' ')"
    ng-class="{
      hidden: beat.visibleSubbeats.indexOf($index+1) === -1
    }"
    ng-style="{
      width: ((beat.subdivision===4? 100 : 66.667))+'%'
    }">

    <div
      ng-repeat="string in ::bass.strings | orderBy:string.index:'-' track by string.index"
      id="bass_{{::beat.bar}}_{{::beat.beat}}_{{::$parent.$index+1}}_{{::string.index}}"

      ng-init="grid={
        bar: beat.bar,
        beat: beat.beat,
        subbeat: $parent.$index+1,
        string: string.index,
        sound: bassSubbeats[string.index].sound
      }"
      class="bass-subbeat"
      ng-style="{
        left: (($parent.$index/beat.subdivision)*(beat.subdivision===4? 100 : 150))+'%'
      }">
      <div
        class="bass-grid"
        drop-validate="dropValidation(grid, $data)"
        ui-drag-channel="section"
        ui-on-drag-enter="onDragEnter($event, grid)"
        ui-on-drag-leave="onDragLeave($event, grid)"
        ui-on-drop="onDrop($event, $data, grid, section)">

        <md-button
          md-no-ink
          aria-label="Sound"
          class="bass-button"
          ng-click="openBassSoundMenu($event, grid)"
          ng-right-click="openBassSoundMenu($event, grid)">+
        </md-button>
      </div>

      <div
        ng-if="grid.sound.note"
        ng-init="updateBassGrid(grid)"
        class="bass-sound-wrapper"
        ng-class="[{
            selected: selected.grid===grid,
            staccato: grid.sound.noteLength.staccato
          },
          grid.sound.note.type,
          grid.sound.style
        ]"
        ng-style="{
          width: (100 * section.timeSignature.bottom * grid.sound.noteLength.beatLength)+'%'
        }">

        <div
          class="top-label"
          ng-style="{
            top: (-32-36*(3-string.index))+'px'
          }">
        </div>

        <div
          ui-draggable="true"
          drag="grid"

          ng-attr-octave="{{ grid.sound.note.octave }}"
          class="bass-sound-container"
          ng-click="selectGrid($event, grid);$event.stopPropagation()"
          ng-right-click="openBassSoundMenu($event, grid)">

          <div
            class="resize-handler">
            <md-icon md-svg-icon="arrow-left-fill"></md-icon>
            <md-icon md-svg-icon="arrow-right-fill"></md-icon>
          </div>

          <div
            class="resize-container"
            resizable
            r-directions="['right']"
            on-resize="onResize(grid, info, $event)"
            on-resize-start="onResizeStart(grid, info, beat.subdivision)"
            on-resize-end="onResizeEnd(grid, info, $event)"
            r-grabber="<div></div>">
          </div>

          <div
            class="label-wrapper"
            ng-switch="grid.sound.note.type">
            <!-- Regular note label -->
            <div ng-switch-when="regular">
              <div ng-if="grid.sound.style === 'ring'">
                <label class="ring">‚èù</label>
              </div>
              <div ng-if="grid.sound.style !== 'ring'">
                <label class="note">
                  {{ grid.sound.note.name }}<sub>{{ grid.sound.note.octave }}</sub>
                </label>
                <label class="fret">
                  {{ grid.sound.note.fret }}
                </label>
              </div>
            </div>

            <!-- Ghost note label -->
            <p ng-switch-when="ghost">x</p>

            <!-- Slide note label -->
            <div ng-switch-when="slide"
              class="slide s-octave-{{ grid.sound.note.octave}} e-octave-{{string.notes[grid.sound.note.fret+grid.sound.note.slide].octave }}"
              ng-class="{down: grid.sound.note.slide > 0}">

              <div ng-if="grid.sound.style !== 'ring'">
                <label class="note">
                  {{ grid.sound.note.name }}<sub>{{ grid.sound.note.octave }}</sub>
                </label>
                <label class="fret">
                  {{ grid.sound.note.fret }}
                </label>
              </div>
              <div
                class="slide-slash"
                ng-class="{up: grid.sound.note.slide > 0}">|
              </div>
              <div>
                <label class="note">
                  {{ string.notes[grid.sound.note.fret+grid.sound.note.slide].label[0] }}
                  <sub>{{ string.notes[grid.sound.note.fret+grid.sound.note.slide].octave }}</sub>
                </label>
                <label class="fret">
                  {{ grid.sound.note.fret+grid.sound.note.slide }}
                </label>
              </div>
            </div>

            <div
              ng-switch-when="grace">
              <label class="note">
                <span class="grace">
                  {{ string.notes[grid.sound.note.fret-2].label[0] }}
                  <sub>{{ string.notes[grid.sound.note.fret-2].octave }}</sub>
                </span>
                {{ grid.sound.note.name }}<sub>{{ grid.sound.note.octave }}</sub>
              </label>
              <label class="fret">
                <span class="grace">
                  {{ grid.sound.note.fret-2 }}
                </span>
                {{ grid.sound.note.fret }}
              </label>
            </div>

            <div
              ng-if="grid.sound.style === 'hammer' || grid.sound.style === 'pull'"
              class="hammer-on-label">
              <span>)</span>
              <span>{{ grid.sound.style === 'hammer'? 'H' : 'P'}}</span>
            </div>
            <!-- <label style="position:absolute;top:30px;left:0;">{{ grid.sound.noteLength.beatLength }}</label> -->

          </div>

        </div>
      </div>

    </div>
  </div>

</div>