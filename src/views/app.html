<div
  layout="column"
  class="main-page"
  ng-cloak>

  <ng-include
    flex="none" class="md-whiteframe-3dp"
    src="'views/main_toolbar.html'">
  </ng-include>

  <div
    ng-if="player.mode === 0"
    flex
    layout="column"
    ng-controller="EditModeController">
    <div flex="none" style="height: 5%;max-height: 65px;">&nbsp</div>
    <div
      class="bar-container"
      ng-controller="BarController"
      ng-class="{
        'graph-enabled': player.graphEnabled
      }"
      msd-wheel="
        workspace.section.beatsPerView = swiperControl.setBeatsPerView(workspace.section.beatsPerView+$delta);
        slidesSizeChanged();
        $event.preventDefault()
      ">
      <div class="bar swiper-container">
        <div class="swiper-wrapper">
          <!-- Slides -->
          <div
            ng-repeat="slide in slides track by slide.id"
            class="swiper-slide bar-slide beat beat-{{ ::slide.beat.beat }}">
            <label class="bar-label">
              {{ ::slide.beat.bar }}
            </label>
            <input
              class="chord-label"
              ng-model="slide.beat.meta.chord"
              ng-blur="slide.beat.meta.chord = slide.beat.meta.chord.replace('#', '♯').replace('b', '♭')">
            <div
              id="beat_{{ ::slide.beat.bar }}_{{ ::slide.beat.beat }}"
              class="bar-beat"
              layout="row"
              ng-right-click="contextMenu.open($event, $index)"
              ng-include src="'views/bar_slide.html'">
            </div>

            <div class="audio-graph-container">
              <canvas class="audio-graph"></canvas>
            </div>

          </div>
        </div>
        <div layout="row" class="swiper-controls">
          <span flex></span>
          <div class="swiper-button-prev"></div>
          <div class="swiper-pagination"></div>
          <div class="swiper-button-next"></div>
          <span flex></span>
        </div>
      </div>

      <div
        class="bar-toolbar">
        <div
          class="bar-preferences"
          ng-include src="'views/bars_form.html'">
        </div>

        <md-button
          md-no-ink
          class="md-fab toggle-button icon-hover audio-graph-toggle"
          ng-class="{active: player.graphEnabled}"
          ng-click="player.graphEnabled = !player.graphEnabled">
          <md-icon md-svg-icon="audio-signal"></md-icon>
          <md-tooltip md-delay="1000" md-direction="right">Toggle audio graph</md-tooltip>
        </md-button>
      </div>

      <div
        class="context-menu"
        ng-include src="'views/bar_context_menu.html'">
      </div>
    </div>
    <div flex
      class="workspace"
      layout="column">
      <div flex="none"
        class="instrument-grid strings-4"
        ng-class="[
          bass.settings.label,
          'strings-'+workspace.track.instrument.strings.length,
          {
            'no-colors': !bass.settings.colors
          }
        ]">

      <div
        ng-show="workspace.track.type === 'bass'"
        class="instrument-left-panel">

        <div class="strings-labels">
          <p ng-repeat="string in workspace.track.instrument.strings | orderBy:string.index:'-' track by string.index">
            {{ ::string.label }}<sub class="octave-index">{{ ::string.octave }}</sub><br>
          </p>
        </div>

      </div>

      <div class="instrument swiper-container">
        <div class="swiper-wrapper">
          <!-- Slides -->
          <div
            ng-repeat="slide in slides track by slide.id"
            class="swiper-slide swiper-no-swiping instrument-slide beat-{{ ::slide.beat.beat }}">
            <div ng-switch="slide.type" ng-class="{obsolete: slide.obsolete}">
              <div
                ng-switch-when="bass"
                ng-controller="BassBeatController">
                  <div class="bass-board"
                    ng-include="'views/bass_board_slide.html'">
                  </div>
              </div>
              <div
                ng-switch-when="drums"
                ng-controller="DrumsController"
                class="drums-beat-grid">
                <div
                  class="drums-beat-container"
                  ng-if="slide.visible"
                  ng-include="'views/drums_board_slide.html'">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      </div>
      <div flex style="max-height: 40px;"></div>

      <div ng-show="workspace.track.type === 'bass'">
        <div
          style="margin-bottom: 20px;"
          ng-include src="'views/fretboard.html'">
        </div>
        <span flex></span>
      </div>

      <div
        ng-if="workspace.track.type === 'drums'"
        layout="column"
        class="drums-labels-container">
        <img
          ng-repeat="drum in workspace.track.instrument track by drum.name"
          ng-src="src/styles/images/{{ ::drum.name }}.svg"
          ng-click="playDrumSound(drum.name)">
      </div>
    </div>
  </div>

  <div
    ng-if="player.mode === 1"
    flex
    layout="column"
    ng-include="'views/playlist.html'"
    ng-class="[
      bass.settings.label,
      {
        'no-colors': !bass.settings.colors
      }
    ]">
  </div>

<!--   <div
    id="time-marker"
    class="time-marker"
    style="visibility:hidden;">
  </div> -->

  <!-- <div flex></div> -->
</div>