<div
  layout="column"
  class="main-page"
  ng-controller="AppController">
  <!-- <div flex></div> -->

  <div
    layout="row"
    class="control-panel">

    <div
      layout="row"
      class="instruments-field">
      <md-button
        flex
        md-no-ink
        class="no-hover"
        ng-class="{
          active: instrumentIndex===0
        }"
        ng-click="instrumentIndex=0">
        Bass
        <md-icon md-svg-icon="bass-guitar"></md-icon>
      </md-button>
      <md-button
        flex
        md-no-ink
        class="no-hover"
        ng-class="{
          active: instrumentIndex===1
        }"
        ng-click="instrumentIndex=1">
        Drums
        <md-icon md-svg-icon="drums"></md-icon>
      </md-button>
      <md-ink-bar
        ng-class="{
          'md-left': instrumentIndex === 0,
          'md-right': instrumentIndex === 1
        }">
      </md-ink-bar>
    </div>

    <md-menu
      md-offset="56 10">
      <md-button
        class="prefferences"
        ng-click="$mdOpenMenu($event)">
        <md-icon
          md-svg-icon="preferences">
        </md-icon>
      </md-button>

      <md-menu-content
        width="4"
        class="prefferences md-whiteframe-16dp">
        <md-list>
          <md-list-item
            class="bass volume-field bottom-border">
            <label>Bass Volume</label>
            <md-slider
              class="md-primary"
              ng-model="player.bass.audio.gain.value"
              ng-disabled="player.bass.muted"
              aria-label="Volume"
              min="0"
              max="1"
              step="0.01"
              flex>
            </md-slider>
            <md-button
              md-no-ink
              class="mute-button"
              ng-class="{active: !player.bass.muted}"
              md-prevent-menu-close
              ng-click="toggleVolumeMute(player.bass)">
              <md-icon
                md-svg-icon="{{ player.bass.muted? 'volume-mute' : 'volume-medium' }}">
              </md-icon>
            </md-button>
          </md-list-item>

          <md-list-item
            class="bass volume-field bottom-border">
            <label>Drums Volume</label>
            <md-slider
              class="md-primary"
              ng-model="player.drums.audio.gain.value"
              ng-disabled="player.drums.muted"
              aria-label="Volume"
              min="0"
              max="1"
              step="0.01"
              flex>
            </md-slider>
            <md-button
              md-no-ink
              class="mute-button"
              ng-class="{active: !player.drums.muted}"
              md-prevent-menu-close
              ng-click="toggleVolumeMute(player.drums)">
              <md-icon
                md-svg-icon="{{ player.drums.muted? 'volume-mute' : 'volume-medium' }}">
              </md-icon>
            </md-button>
          </md-list-item>
        </md-list>

      </md-menu-content>
    </md-menu>

    <div flex></div>

    <div
      class="bpm-field">
      <md-input-container>
        <label>bpm</label>
        <input
          type="number"
          min="30"
          max="200"
          step="5"
          ng-model="player.bpm">
      </md-input-container>
    </div>

    <md-button
      class="play-stop-button"
      ng-click="player.playing? stop() : play()">
      <md-icon
        md-svg-icon="{{ player.playing? 'stop' : 'play' }}">
      </md-icon>
      {{ player.playing? 'Stop' : 'Play' }}
    </md-button>

    <div flex></div>

    <div
      layout="row"
      class="present-field">
      <md-input-container>
        <label>Section</label>
        <input
          type="text"
          ng-model="project.sectionName">
      </md-input-container>
      <md-input-container>
        <md-select
          ng-show="project.sections.length > 0"
          aria-label="Section"
          class="select-editable"
          ng-model="project.selectedSectionIndex"
          md-on-close="loadSection(project.selectedSectionIndex)">
          <md-option
            ng-repeat="section in project.sections"
            ng-value="$index">
            {{ section }}
          </md-option>
        </md-select>
      </md-input-container>
      <md-button
        aria-label="Save"
        class="toolbar-button"
        ng-click="saveSection(project.selectedSectionIndex, project.sectionName)">
        <md-icon
          md-svg-icon="pen">
        </md-icon>
      </md-button>
      <md-menu md-position-mode="target-right target">
        <md-button
          aria-label="Menu"
          class="toolbar-button"
          ng-click="$mdOpenMenu($event)">
          <md-icon
            md-svg-icon="menu-dots">
          </md-icon>
        </md-button>
        <md-menu-content
          class="md-whiteframe-16dp">
          <md-menu-item>
            <md-button
              ng-click="clearSection()">
              New
            </md-button>
          </md-menu-item>
          <md-menu-item>
            <md-button
              ng-click="deleteSection(project.selectedSectionIndex)">
              Delete
            </md-button>
          </md-menu-item>
        </md-menu-content>
      </md-menu>
    </div>
  </div>

  <div
    class="bar-container"
    msd-wheel="
      slides.beatsPerView=slides.beatsPerView+$delta;
      beatsPerViewChanged()
    ">
    <div
      class="time-signature-button"
      ng-include src="'views/bars_form.html'">
    </div>
    <ks-swiper-container
      id="barSwiper"
      swiper="swiper"
      on-ready="onBarSwiper(swiper)"
      initial-slide="0"
      loop="false"
      show-nav-buttons="true"
      slides-per-view="slides.beatsPerView"
      space-between="0"
      pagination-clickable="true"
      override-parameters="{
        slidesPerGroup: slides.beatsPerSlide,
        roundLengths: true
      }">

      <ks-swiper-slide
        ng-repeat="beat in slides.bars track by beat.id"
        class="beat beat-{{ ::beat.beat }}">
        <div
          xng-init="renderingBar($index)"
          ng-include src="'views/bar_slide.html'">
        </div>
      </ks-swiper-slide>
    </ks-swiper-container>
  </div>

  <md-tabs
    md-no-ink
    layout-fill
    class="instruments-tabs"
    md-selected="instrumentIndex"
    xng-init="instrumentIndex=1">
    <md-tab label="bass">
  <div
    class="bass-board-container"
    ng-controller="NoteController">
    <md-button
      aria-label="Tunning"
      class="bass-tunning-button">
      <p ng-repeat="string in bass.strings | orderBy:string.index:'-'">
        {{ string.label }}<sub class="octave-index">{{ string.octave }}</sub><br>
      </p>
    </md-button>

    <div
      class="drop-note-area"
      ng-style="{
        width: dropNote.width+'px',
        left: dropNote.left===3? '-5000px' : dropNote.left+'px',
        top: dropNote.top+'px',
        opacity: dropNote.visible? 1 : 0
      }">
      <label>{{ dropNote.resizeNoteLength }}</label>
    </div>

    <div
      ng-include src="'views/bass_sound_form.html'">
    </div>
    <ks-swiper-container
      swiper="swiper"
      on-ready="onBassSwiper(swiper)"
      initial-slide="0"
      loop="false"

      show-nav-buttons="false"
      slides-per-view="slides.beatsPerView"
      space-between="0"
      override-parameters="{
        slidesPerGroup: slides.beatsPerSlide,
        roundLengths: true
      }">

      <ks-swiper-slide
        ng-repeat="beat in slides.bass track by beat.id"
        class="swiper-no-swiping beat-{{ ::beat.beat }}"
        style="z-index: {{ ::100-$index}};">
        <div class="audio-graph-container">
          <canvas
            id="canvas_{{ ::beat.bar }}_{{ ::beat.beat }}"
            class="audio-graph">
          </canvas>
        </div>
        <div
          ng-init="renderingBar($index)"
          ng-include src="'views/bass_board_slide.html'">
        </div>
      </ks-swiper-slide>
    </ks-swiper-container>
  </div>

  <div
    style="margin-bottom: 20px;"
    ng-include src="'views/fretboard.html'">
  </div>
  </md-tab>
    <md-tab
      label="drums">
      <div
        class="drums-container"
        ng-controller="DrumsController">
        <div
          layout="column"
          class="drums-labels-container">
          <md-button
            aria-label="{{ ::drum.label }}"
            class="drum-label"
            ng-repeat="drum in drums">
            {{ ::drum.label }}
          </md-button>
        </div>
        <ks-swiper-container
          swiper="swiper"
          on-ready="onDrumsSwiper(swiper)"
          initial-slide="0"
          loop="false"

          show-nav-buttons="false"
          slides-per-view="slides.beatsPerView"
          space-between="0"
          override-parameters="{
            slidesPerGroup: slides.beatsPerSlide,
            roundLengths: true
          }">

          <ks-swiper-slide
            class="swiper-no-swiping"
            ng-repeat="beat in slides.drums track by beat.id">
            <div
              ng-include src="'views/drums_board_slide.html'">
            </div>
          </ks-swiper-slide>
        </ks-swiper-container>
      </div>
    </md-tab>
  </md-tabs>

  <div id="time-marker" class="time-marker"></div>

  <div flex></div>
</div>