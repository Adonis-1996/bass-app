<div
  layout="row"
  class="control-panel"
  ng-class="[player.mode === 0? 'section-mode' : 'playlist-mode']">

  <div
    layout="row"
    class="instruments-toolbar">

    <!-- Track selectbox -->
    <md-input-container class="track">
      <label>Track</label>
      <md-select
        md-no-ink
        aria-label="Track"
        class="tracks-list"
        ng-init="ui.trackId = 'bass_0'"
        ng-model="ui.trackId"
        ng-change="ui.trackId && ui.selectTrack(ui.trackId)"
        md-on-close="ui.trackId = workspace.track.id">

        <md-option
          ng-repeat="track in project.tracks track by track.id"
          ng-value="track.id">
          <md-icon md-svg-icon="{{ track.type }}"></md-icon>
          {{ track.name }}
        </md-option>

        <md-divider></md-divider>
        <div layout="row" class="track-split-item">
          <md-option
            ng-value="false"
            ng-click="ui.addTrack($event)">
            <md-icon md-svg-icon="plus"></md-icon>
            New
          </md-option>
          <md-option
            ng-value="false"
            ng-click="ui.removeTrack(ui.trackId)">
            <md-icon md-svg-icon="x"></md-icon>
            Remove
          </md-option>
        </div>

      </md-select>
    </md-input-container>

    <md-menu
      md-offset="0 10">
      <md-button
        md-no-ink
        aria-label="Volume"
        class="preferences icon-hover toolbar-button"
        ng-disabled="workspace.trackSection.type === 'drums'"
        ng-click="
          ui.bassLayout = workspace.trackSection.instrument.layout;
          $mdOpenMenu($event)
        ">
        <md-icon
          md-svg-icon="preferences">
        </md-icon>
        <md-tooltip md-delay="1500">Instrument preferences</md-tooltip>
      </md-button>
      <md-menu-content
        width="4"
        class="preferences md-whiteframe-16dp">
        <ng-include src="'views/bass_settings.html'"></ng-include>
      </md-menu-content>
    </md-menu>

    <md-menu
      md-offset="10 10">
      <md-button
        md-no-ink
        aria-label="Volume"
        class="preferences icon-hover toolbar-separated-button"
        ng-click="$mdOpenMenu($event)">
        <md-icon
          md-svg-icon="volume-medium">
        </md-icon>
        <md-tooltip md-delay="1500">Volume preferences</md-tooltip>
      </md-button>

      <md-menu-content
        md-no-ink
        width="4"
        class="preferences md-whiteframe-16dp">
        <md-list>

          <md-list-item
            ng-repeat="track in project.tracks track by track.id"
            class="volume-field bottom-border">
            <label>
              <md-icon
                style="padding-right: 8px;"
                md-svg-icon="{{ track.type }}">
              </md-icon>
              {{ track.name }}
            </label>
            <rzslider
              rz-slider-model="track.audio.gain.value"
              rz-slider-options="{
                floor: 0,
                ceil: 1,
                step: 0.01,
                precision: 2,
                hideLimitLabels: true,
                hidePointerLabels: true,
                showSelectionBar: true,
                disabled: track.muted
              }">
            </rzslider>
            <md-button
              md-no-ink
              aria-label="Mute"
              class="mute-button"
              ng-class="{active: !track.muted}"
              md-prevent-menu-close
              ng-click="toggleVolumeMute(track)">
              <md-icon
                md-svg-icon="{{ track.muted? 'volume-mute' : 'volume-medium' }}">
              </md-icon>
            </md-button>
          </md-list-item>

          <md-list-item
            class="volume-field bottom-border">
            <label>Input Volume</label>
            <rzslider
              rz-slider-model="player.input.audio.gain.value"
              rz-slider-options="{
                floor: 0,
                ceil: 1,
                step: 0.01,
                precision: 2,
                hideLimitLabels: true,
                hidePointerLabels: true,
                showSelectionBar: true,
                disabled: player.input.muted
              }">
            </rzslider>
            <md-button
              md-no-ink
              aria-label="Mute"
              class="mute-button"
              ng-class="{active: !player.input.muted}"
              md-prevent-menu-close
              ng-click="toggleInputMute(player.input)">
              <md-icon
                md-svg-icon="{{ player.input.muted? 'volume-mute' : 'volume-medium' }}">
              </md-icon>
            </md-button>
          </md-list-item>
        </md-list>

      </md-menu-content>
    </md-menu>

  </div>

  <div flex></div>

  <div
    layout="row"
    class="playback-fields">

    <md-input-container class="bpm-field">
      <label>Speed</label>
      <input
        type="number"
        min="30"
        max="200"
        step="5"
        ng-model="workspace.section.bpm"
        ng-change="ui.bpmChanged(workspace.section.bpm)">
    </md-input-container>

    <md-input-container class="playback-speed-field">
      <label>Speed</label>
      <input
        type="number"
        min="20"
        max="300"
        step="5"
        ng-model="player.speed"
        ng-change="ui.playbackSpeedChanged(player.speed)">
    </md-input-container>

    <md-button
      md-no-ink
      aria-label="Play"
      class="play-stop-button icon-hover"
      ng-click="player.playing? player.stop() : player.play()">
      <md-icon
        md-svg-icon="{{ player.playing? 'stop' : 'play' }}">
      </md-icon>
      {{ player.playing? 'Stop' : 'Play' }}
    </md-button>

    <md-button
      md-no-ink
      aria-label="Countdown"
      class="toggle-button toolbar-separated-button icon-hover"
      ng-class="{active: player.countdown}"
      ng-click="player.countdown=!player.countdown">
      <md-icon
        md-svg-icon="countdown">
      </md-icon>
      <md-tooltip md-delay="1500">Countdown</md-tooltip>
    </md-button>

    <md-button
      md-no-ink
      aria-label="Loop"
      class="toggle-button toolbar-separated-button icon-hover"
      ng-class="{active: player.loop}"
      ng-click="player.loop=!player.loop">
      <md-icon
        md-svg-icon="loop">
      </md-icon>
      <md-tooltip md-delay="1500">Repeat mode</md-tooltip>
    </md-button>

    <md-menu
      md-position-mode="target target"
      md-offset="10, 0"
      class="playback-range-menu">
      <md-button
        md-no-ink
        class="toggle-button toolbar-separated-button icon-hover"
        ng-class="{
          active: player.playbackRange.start > 1 || player.playbackRange.end < workspace.section.length+1
        }"
        ng-click="$mdOpenMenu($event)">
        <md-icon md-svg-icon="playback-range"></md-icon>
        <md-tooltip md-delay="1500">Playback range</md-tooltip>
      </md-button>
      <md-menu-content
        class="preferences playback-range md-whiteframe-16dp">
        <md-list>
          <md-list-item class="range-slider-item playback-range">
            <label>Playback range</label>
            <rzslider
              class="range-slider"
              ng-class="{ long: workspace.section.length > 10 }"
              rz-slider-model="player.playbackRange.start"
              rz-slider-high="player.playbackRange.end"
              rz-slider-options="{
                floor: 1,
                ceil: workspace.section.length+1,
                step: 1,
                minRange: 1,
                pushRange: true,
                showTicks: true,
                onEnd: player.playbackRangeChanged,
                showTicksValues: true
              }">
            </rzslider>
          </md-list-item>

          <!-- <md-list-item md-no-ink class="checkbox-item">
            <md-input-container>
              <md-checkbox
                ng-model="player.visibleBeatsOnly"
                ng-change="!player.visibleBeatsOnly && player.playbackRangeChanged()">
                Visible beats only
              </md-checkbox>
            </md-input-container>
          </md-list-item> -->

        </md-list>
      </md-menu-content>
    </md-menu>

    <md-button
      md-no-ink
      aria-label="Loop"
      class="screen-playback toggle-button toolbar-separated-button icon-hover"
      ng-class="{active: player.visibleBeatsOnly}"
      ng-click="
        player.visibleBeatsOnly =! player.visibleBeatsOnly;
        !player.visibleBeatsOnly && player.playbackRangeChanged()
      ">
      <md-icon
        md-svg-icon="screen-playback">
      </md-icon>
      <md-tooltip md-delay="1500">Visible screen playback</md-tooltip>
    </md-button>

  </div>

  <div flex></div>

  <div class="mode-switch">
    <label>Mode</label>
    <md-button
      md-no-ink
      aria-label="Loop"
      class="toggle-button toolbar-button icon-hover"
      ng-class="{active: player.mode === 0}"
      ng-click="player.mode = 0">
      <md-icon
        md-svg-icon="section-mode">
      </md-icon>
      <md-tooltip md-delay="1500">Section mode</md-tooltip>
    </md-button>
    <md-button
      md-no-ink
      aria-label="Loop"
      class="toggle-button toolbar-button icon-hover"
      ng-class="{active: player.mode === 1}"
      ng-click="player.mode = 1">
      <md-icon
        md-svg-icon="playlist-mode">
      </md-icon>
      <md-tooltip md-delay="1500">Playlist mode</md-tooltip>
    </md-button>
  </div>

  <div
    layout="row"
    class="project-toolbar"
    ng-controller="ProjectController">
    <form ng-if="player.mode === 0">
      <md-input-container>
        <label>Section</label>
        <input
          required
          type="text"
          autocomplete="off"
          ng-model="workspace.section.name">
      </md-input-container>
      <md-input-container>
        <md-select
          md-no-ink
          ng-show="project.sections.length > 1"
          aria-label="Section"
          class="select-editable"
          md-container-class="sections-list"
          ng-model="workspace.selectedSectionIndex"
          ng-change="loadSection(workspace.selectedSectionIndex)">
          <md-option
            ui-draggable="true"
            drag="$index"
            ui-on-drag-enter=""
            ui-on-drag-leave=""
            ui-on-drop="dropSection($event, $data, $index, section)"
            drag-channel="section"
            drop-channel="section"

            ng-repeat="section in project.sections | orderBy:section.index track by $index"
            ng-value="::$index">
            {{ section.name }}
          </md-option>
        </md-select>
      </md-input-container>
      <md-button type="submit"
        md-no-ink
        aria-label="Save"
        class="toolbar-button icon-hover"
        ng-click="projectManager.saveSection(workspace.selectedSectionIndex)">
        <md-icon
          md-svg-icon="save">
        </md-icon>
        <md-tooltip md-delay="1500">Save</md-tooltip>
      </md-button>
    </form>

    <form ng-if="player.mode === 1">
      <md-input-container class="playlist-field">
        <label>Playlist</label>
        <input
          type="text"
          ng-model="workspace.playlist.name">
        <md-button
          md-no-ink
          class="toolbar-button icon-hover toggle-button edit-playlist"
          ng-class="{active: ui.playlist.showEditor}"
          ng-click="ui.playlist.showEditor = !ui.playlist.showEditor">
          <md-icon md-svg-icon="pen"></md-icon>
        </md-button>
      </md-input-container>
      <md-input-container>
        <md-select
          md-no-ink
          ng-show="project.sections.length > 1"
          aria-label="Section"
          class="select-editable"
          md-container-class="sections-list"
          ng-model="ui.selectedPlaylistIndex"
          ng-change="loadPlaylist(ui.selectedPlaylistIndex)">
          <md-option
            ui-draggable="true"
            drag="$index"
            ui-on-drag-enter=""
            ui-on-drag-leave=""
            ui-on-drop="dropSection($event, $data, $index, section)"
            drag-channel="section"
            drop-channel="section"

            ng-repeat="playlist in project.playlists | orderBy:playlist.index track by $index"
            ng-value="::$index">
            {{ playlist.name }}
          </md-option>
        </md-select>
      </md-input-container>
      <md-button
        md-no-ink
        aria-label="Save"
        class="toolbar-button icon-hover"
        ng-click="projectManager.savePlaylists()">
        <md-icon
          md-svg-icon="save">
        </md-icon>
        <md-tooltip md-delay="1500">Save</md-tooltip>
      </md-button>
    </form>

    <md-menu
      md-position-mode="target-right target">
      <md-button
        md-no-ink
        aria-label="Menu"
        class="toolbar-separated-button icon-hover"
        ng-click="$mdOpenMenu($event)">
        <md-icon
          md-svg-icon="menu-dots">
        </md-icon>
        <md-tooltip md-delay="1500">Options</md-tooltip>
      </md-button>
      <md-menu-content
        md-no-ink
        width="3"
        class="big md-whiteframe-16dp">


        <md-menu-item class="menu-group-item">
          <md-divider></md-divider>
          <div layout="row">
            <span flex></span>
            <span flex="none" class="group-item-title">Project</span>
            <span flex="5"></span>
          </div>
        </md-menu-item>

        <md-menu-item>
          <md-button
            md-no-ink
            aria-label="New"
            ng-click="">
            New
          </md-button>
        </md-menu-item>

        <md-menu-item>
          <md-button
            md-no-ink
            aria-label="Open"
            ng-click="">
            Open
          </md-button>
        </md-menu-item>

        <md-menu-item
          ng-if-start="player.mode === 0"
          class="menu-group-item">
          <md-divider></md-divider>
          <div layout="row">
            <span flex></span>
            <span flex="none" class="group-item-title">Section</span>
            <span flex="5"></span>
          </div>
        </md-menu-item>

        <md-menu-item>
          <md-button
            md-no-ink
            aria-label="New"
            ng-click="newSection()">
            New
          </md-button>
        </md-menu-item>
        <md-menu-item>
          <md-button
            md-no-ink
            aria-label="Save As"
            ng-click="saveSection()">
            Save As...
          </md-button>
        </md-menu-item>
        <md-menu-item>
          <md-button
            md-no-ink
            aria-label="Delete"
            ng-click="projectManager.deleteSection(workspace.selectedSectionIndex)">
            Delete
          </md-button>
        </md-menu-item>
        <md-menu-item ng-if-end>
          <md-button
            md-no-ink
            aria-label="Export"
            ng-click="exportToFile()">
            Export
          </md-button>
        </md-menu-item>

        <md-menu-item
          ng-if-start="player.mode === 1"
          class="menu-group-item">
          <md-divider></md-divider>
          <div layout="row">
            <span flex></span>
            <span flex="none" class="group-item-title">Playlist</span>
            <span flex="5"></span>
          </div>
        </md-menu-item>

        <md-menu-item>
          <md-button
            md-no-ink
            aria-label="New"
            ng-click="createPlaylist()">
            New
          </md-button>
        </md-menu-item>
        <md-menu-item ng-if-end>
          <md-button
            md-no-ink
            aria-label="Delete"
            ng-click="deletePlaylist()">
            Delete
          </md-button>
        </md-menu-item>

      </md-menu-content>
    </md-menu>
  </div>

</div>